dist: trusty
sudo: false

language: rust

before_install:
  - if [ "${TARGET}" = "asmjs-unknown-emscripten" ] && [ "$CXX" = "g++" ]; then export CXX="g++-4.9" CC="gcc-4.9"; fi
  - if [ "${TARGET}" = "asmjs-unknown-emscripten" ]; then
      wget https://s3.amazonaws.com/mozilla-games/emscripten/releases/emsdk-portable.tar.gz
      && tar -xvf emsdk-portable.tar.gz
      && ./emsdk-portable/emsdk update
      && ./emsdk-portable/emsdk install emscripten-1.35.0
      && ./emsdk-portable/emsdk activate emscripten-1.35.0
      && ./emsdk-portable/emsdk install clang-e1.35.0-64bit
      && ./emsdk-portable/emsdk activate clang-e1.35.0-64bit
      && source emsdk-portable/emsdk_env.sh
      && emcc -v;
    fi
  - (rustup toolchain list | grep $TARGET) || rustup target install $TARGET

script:
  - cargo build --target $TARGET
  - cd demo && cargo build --target $TARGET

matrix:
  include:
    - os: linux
      env: TARGET=asmjs-unknown-emscripten
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-4.9
    - os: linux
      env: TARGET=x86_64-unknown-linux-gnu
    - os: linux
      env: TARGET=i686-unknown-linux-gnu
      addons:
        apt:
          packages:
            - gcc-multilib
    - os: osx
      env: TARGET=x86_64-apple-darwin
    - os: osx
      env: TARGET=i686-apple-darwin
    - os: osx
      env: TARGET=i386-apple-ios
